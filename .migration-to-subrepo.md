# Migration to git-subrepo

## Current Status
- git-subrepo is installed âœ…
- momo is currently a git submodule with unpushed commits

## Migration Steps

### 1. Commit/push the pending momo submodule commit
```bash
cd momo
git push origin main
cd ..
git add momo
git commit -m "chore: update momo submodule pointer"
```

### 2. Remove the git submodule
```bash
# Deinitialize and remove submodule tracking
git submodule deinit -f momo
git rm -f momo
rm -rf .git/modules/momo

# Commit the removal
git commit -m "chore: remove momo as git submodule (preparing for git-subrepo)"
```

### 3. Clone momo as git-subrepo
```bash
# This will clone the momo repo into the momo/ directory
# and set it up as a git-subrepo
git subrepo clone git@github.com:momomemory/momo.git momo

# This creates a commit with metadata
```

### 4. Verify the setup
```bash
# Check subrepo status
git subrepo status

# Should show:
# Git subrepo 'momo':
#   Remote URL:  git@github.com:momomemory/momo.git
#   Tracking Branch: main
#   ...
```

### 5. Update .gitmodules cleanup
```bash
# The .gitmodules file should be gone after step 2
# If it still exists, remove it:
rm .gitmodules
git add .gitmodules
git commit -m "chore: remove .gitmodules file"
```

## How git-subrepo Works

### Directory Structure
After conversion, momo/ looks like a normal directory (no .git inside it).
But git knows it's a subrepo via a `.gitrepo` file.

### Making Changes to momo/
```bash
# 1. Edit files in momo/
vim momo/src/main.rs

# 2. Commit normally in the root repo
git add momo/src/main.rs
git commit -m "feat(momo): add new feature"

# 3. Push changes back to the momo repo
git subrepo push momo

# That's it! No cd-ing into submodules, no detached HEAD
```

### Pulling Changes from momo repo
```bash
# Someone else pushed to momo repo, pull those changes:
git subrepo pull momo

# This merges their changes into your root repo
```

### When Creating New SDKs
```bash
# Create the remote repo first (e.g., on GitHub)
# Then add it as a subrepo:
git subrepo clone git@github.com:momomemory/sdk-typescript.git sdks/typescript

# Now sdks/typescript/ works the same way as momo/
```

## Common Operations

### See all subrepos
```bash
git subrepo status
```

### Pull all subrepos
```bash
git subrepo pull --all
```

### Push all subrepos
```bash
git subrepo pull --all  # Pull first to avoid conflicts
git subrepo push --all
```

### Check if a subrepo is clean (no unpushed commits)
```bash
git subrepo clean momo
```

## Troubleshooting

### "parent is out of sync" error
This means the subrepo has commits that haven't been pushed yet.
```bash
git subrepo push momo  # Push the pending commits
```

### Want to see the full git-subrepo command options?
```bash
git subrepo help
git subrepo help push
git subrepo help pull
```

## Next Steps
After migration, add convenient justfile recipes (see next section).
